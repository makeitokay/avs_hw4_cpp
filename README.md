# ИДЗ по АВС №4 / Вариант №4
## Васильев Андрей Михайлович / БПИ215

Работа выполнена с соблюдением всех критериев на **6 БАЛЛОВ**.

## Условие задачи

Задача о читателях и писателях. Базу данных разделяют два типа процессов – читатели и писатели. Читатели выполняют транзакции, которые
просматривают записи базы данных, транзакции писателей и просматривают
и изменяют записи. Предполагается, что в начале БД находится в непротиворечивом состоянии (например, если каждый элемент — число, то они все отсортированы). Каждая отдельная транзакция переводит БД из одного непротиворечивого состояния в другое. Для предотвращения взаимного влияния
транзакций процесс-писатель должен иметь исключительный доступ к БД.
Если к БД не обращается ни один из процессов-писателей, то выполнять
транзакции могут одновременно сколько угодно читателей. Создать многопоточное приложение с потоками-писателями и потоками-читателями. Реализовать решение, используя семафоры.

### Описание решения задачи

- Задача решена с помощью механизма синхронизации - семафора.
- Входных данных в программе не предусмотрено.
- Описание взаимодействия сущностей: в цикле по очереди создается читатель, затем писатель. Всего итераций цикла 10, то есть будет создано 10 читателей и 10 писателей.
  - Читатель при инициализации проверяет, какой он по счету. Если первый, то блокирует доступ к ресурсу (или наоборот ждет освобождения ресурса). Стоит отметить, что при этом читателем блокируется и доступ к счетчику читателей, а освобождается он в момент получения читателем доступа к ресурсу. Это значит, что остальные читатели тоже не получат доступ к ресурсу, пока его не получит первый. При этом, если первый читатель заблокировал доступ к ресурсу, остальные в условие ожидания доступа не попадут. Этот механизм и обеспечивает одновременное чтение несколькими читателями.
  - С писателем все немного проще. При инициализации он либо ждет доступ к ресурсу, либо экслюзивно блокирует его. Записывает в ресурс рандомное число, переводит в непротиворечивое состояние (сортирует) и освобождает доступ.
  - При создании читателей и писателей в цикле, программа замедляет создание на `кол-во читателей в данный момент * 0,2 с`. Это нужно, чтобы избежать ситуации, когда все 10 потоков-читателей используют ресурс одновременно, не освобождая его для писателя. Поток читателя, инициализируясь, блокирует доступ к ресурсу для писателя, а вот для других читателей - нет. Это значит, что читатели будут работать, а писатель - ждать. Поэтому специально ждем, чтобы читатели завершили свою работу, перед тем как создавать читателей и писателей дальше.

### Компиляция

`g++ -o cpp_program -pthread main.cpp`